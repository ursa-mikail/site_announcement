<!DOCTYPE html>
<html style="height: 100%">
<head>
  <meta charset="UTF-8">
  <title>Emotions Tree</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/themes/base/jquery-ui.min.css">
  <style>
    #main {
      height: 100%;
      width: 100%;
    }
    #search-container {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 10;
      background-color: white;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 4px;
    }
    #autocomplete {
      padding: 5px;
      width: 200px;
    }
  </style>
</head>
<body style="height: 100%; margin: 0">
  <div id="search-container">
    <input id="autocomplete" type="text" placeholder="Search Emotions...">
  </div>
  <div id="main"></div>
  
  <script>
    const myChart = echarts.init(document.getElementById('main'));
    myChart.showLoading();

    function csvToTree(csvData) {
      const lines = csvData.split('\n');
      const root = {
        name: 'Emotions',
        children: []
      };
      
      const allEmotions = new Set();
      
      lines.forEach(line => {
        const emotions = line.split(',')
          .map(e => e.trim())
          .filter(e => e.length > 0);
        
        if (emotions.length === 0) return;
        
        let currentNode = root;
        emotions.forEach(emotion => {
          allEmotions.add(emotion);
          let child = currentNode.children?.find(c => c.name === emotion);
          if (!child) {
            child = {
              name: emotion,
              children: []
            };
            currentNode.children.push(child);
          }
          currentNode = child;
        });
      });

      // Setup autocomplete data
      $(#autocomplete).autocomplete({
        source: Array.from(allEmotions),
        select: function(event, ui) {
          const selectedEmotion = ui.item.value;
          highlightNode(selectedEmotion);
        }
      });

      return root;
    }

    function highlightNode(emotionName) {
      myChart.dispatchAction({
        type: 'highlight',
        seriesName: 'Emotions',
        name: emotionName
      });
      
      myChart.dispatchAction({
        type: 'showTip',
        seriesName: 'Emotions',
        name: emotionName
      });
    }

    fetch('https://raw.githubusercontent.com/ursa-mikail/emotions_clusters/refs/heads/main/emotions_clusters.csv')
      .then(response => response.text())
      .then(csvData => {
        const treeData = csvToTree(csvData);
        myChart.hideLoading();
        
        const option = {
          tooltip: {
            trigger: 'item',
            triggerOn: 'mousemove'
          },
          series: [{
            type: 'tree',
            name: 'Emotions',
            data: [treeData],
            top: '1%',
            left: '7%',
            bottom: '1%',
            right: '20%',
            symbolSize: 7,
            label: {
              position: 'left',
              verticalAlign: 'middle',
              align: 'right',
              fontSize: 12
            },
            leaves: {
              label: {
                position: 'right',
                verticalAlign: 'middle',
                align: 'left'
              }
            },
            emphasis: {
              focus: 'descendant'
            },
            expandAndCollapse: true,
            animationDuration: 550,
            animationDurationUpdate: 750,
            initialTreeDepth: 2
          }]
        };

        myChart.setOption(option);
      });

    // Handle window resizing
    window.addEventListener('resize', () => {
      myChart.resize();
    });
  </script>
</body>
</html>