<!DOCTYPE html>
<html style="height: 100%">
<head>
    <meta charset="UTF-8">
    <title>Emotions Tree</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-ui-dist/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-ui-dist/jquery-ui.min.css">
    <style>
        #main {
            height: 100%;
            width: 100%;
        }
        #autocomplete {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10;
            background-color: white;
            border: 1px solid #ccc;
            padding: 5px;
        }
    </style>
</head>
<body style="height: 100%; margin: 0">
    <input id="autocomplete" type="text" placeholder="Search Emotions..." />
    <div id="main" style="height: 100%"></div>

    <script type="text/javascript">
        var myChart = echarts.init(document.getElementById('main'));
        myChart.showLoading();

        $.get('https://raw.githubusercontent.com/ursa-mikail/emotions_clusters/refs/heads/main/emotions_clusters.csv', function (csvData) {
            var lines = csvData.split('\n');
            var nodes = [];
            var links = [];
            var emotionsMap = {};

            lines.forEach(function (line) {
                var columns = line.split(',');
                if (columns.length < 2) return;

                var emotion = columns[1].trim();
                var parent = columns[0].trim(); // Get the parent emotion

                if (!emotionsMap[emotion]) {
                    emotionsMap[emotion] = true;
                    nodes.push({
                        id: emotion,
                        name: emotion,
                    });
                }
                if (parent && !emotionsMap[parent]) {
                    emotionsMap[parent] = true;
                    nodes.push({
                        id: parent,
                        name: parent,
                    });
                }
                if(parent)
                {
                    links.push({ source: parent, target: emotion });
                }
            });

            var graph = {
                nodes: nodes,
                links: links,
            };

            myChart.hideLoading();

            var option = {
                tooltip: {},
                series: [
                    {
                        name: 'Emotions',
                        type: 'tree',
                        data: [graph.nodes[0]], // Start with the root node
                        initialTreeDepth: 3, // Adjust initial depth as needed
                        layout: 'radial',
                        roam: true,
                        label: {
                            position: 'inside',
                            verticalAlign: 'middle',
                            align: 'center',
                            fontSize: 9,
                            rotate: 'tangential'
                        },
                        leaves: {
                            label: {
                                position: 'right',
                                verticalAlign: 'middle',
                                align: 'left',
                                fontSize: 9
                            }
                        },
                        expandAndCollapse: true,
                        animationDuration: 550,
                        animationEasing: 'linear',
                        lineStyle: {
                            curveness: 0.5
                        }

                    }
                ]
            };


            myChart.setOption(option);

            $("#autocomplete").autocomplete({
                source: Object.keys(emotionsMap),
                select: function (event, ui) {
                    var selectedEmotion = ui.item.value;
                    highlightNode(selectedEmotion);
                }
            });

            function highlightNode(emotion) {
                myChart.dispatchAction({
                    type: 'focusNode',
                    seriesIndex: 0,
                    node: emotion
                });
            }
        });
    </script>
</body>
</html>